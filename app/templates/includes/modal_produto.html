<div id="modalProduto" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-slate-800 rounded-xl shadow-2xl w-full max-w-2xl transform transition-all max-h-[95vh] overflow-y-auto my-4">
        <form method="POST" action="{{ url_for('admin.admin_produtos') }}" id="formProduto">
            <div class="bg-slate-900 px-6 py-4 rounded-t-xl border-b border-slate-700 flex justify-between items-center">
                <h2 class="text-xl font-bold text-amber-500" id="modalTitulo">Novo Produto</h2>
                <button type="button" onclick="fecharModalProduto()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="p-6 space-y-4">
                <input type="hidden" name="produto_id" id="prod_id">

                <div>
                    <label class="block text-gray-400 text-sm mb-1">Nome do Produto *</label>
                    <input type="text" name="nome" id="prod_nome" required class="w-full bg-slate-700 text-white rounded p-2 border border-slate-600">
                </div>


                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">ID ERP (Opcional)</label>
                        <input type="text" name="id_erp" id="prod_iderp" class="w-full bg-slate-700 text-white rounded p-2 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">GTIN (Opcional)</label>
                        <input type="text" name="gtin" id="prod_gtin" class="w-full bg-slate-700 text-white rounded p-2 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Categoria</label>
                        <input type="text" name="categoria" id="prod_categoria" class="w-full bg-slate-700 text-white rounded p-2 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Status do Produto</label>
                        <div class="flex items-center h-10 bg-slate-700 rounded p-2 border border-slate-600">
                            <input type="checkbox" name="ativo" id="prod_ativo" checked class="w-5 h-5 bg-slate-600 border-slate-500 rounded focus:ring-amber-500">
                            <label for="prod_ativo" class="ml-3 text-white font-medium">Produto Ativo</label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Unidade Padrão *</label>
                        <select name="id_unidade_padrao" id="prod_unidade_padrao" required class="w-full bg-slate-700 text-white rounded p-2 border border-slate-600">
                            {% for u in unidades %}
                            <option value="{{ u.id }}">{{ u.sigla }} - {{ u.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Preço de Custo (R$)</label>
                        <input type="number" step="0.01" name="preco_custo" id="prod_preco_custo" class="w-full bg-slate-700 text-white rounded p-2 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Preço de Venda (R$)</label>
                        <input type="number" step="0.01" name="preco_venda" id="prod_preco_venda" class="w-full bg-slate-700 text-white rounded p-2 border border-slate-600">
                    </div>
                </div>

                <div class="mt-6 pt-4 border-t border-slate-700">
                    <h3 class="text-lg font-bold text-white mb-2">Unidades Secundárias Permitidas</h3>
                    <p class="text-sm text-gray-400 mb-4">Marque as caixas e defina quantos KGs/Lts cabem na embalagem.</p>
                    <div class="grid grid-cols-1 gap-2 max-h-60 overflow-y-auto">
                        {% for u in unidades %}
                        <div class="flex items-center bg-slate-750 p-2 rounded border border-slate-700 hover:bg-slate-700">
                            <div class="flex items-center h-5">
                                <input type="checkbox" name="unidades_permitidas" value="{{ u.id }}" id="chk_und_{{ u.id }}" onclick="toggleFator({{ u.id }})" class="w-5 h-5 bg-slate-600 border-slate-500 rounded focus:ring-amber-500">
                            </div>
                            <div class="ml-3 flex-1 grid grid-cols-2 gap-4 items-center">
                                <label for="chk_und_{{ u.id }}" class="text-sm font-medium text-gray-200">{{ u.nome }} ({{ u.sigla }})</label>
                                <div class="flex items-center gap-2">
                                    <span class="text-xs text-gray-500">Peso:</span>
                                    <input type="number" step="0.001" name="fator_{{ u.id }}" id="fator_{{ u.id }}" placeholder="1.0" disabled class="w-full bg-slate-900 text-white text-sm rounded p-1 border border-slate-600 disabled:opacity-30">
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="bg-slate-900 px-6 py-4 rounded-b-xl border-t border-slate-700 flex justify-end gap-3">
                <button type="button" onclick="fecharModalProduto()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded font-bold">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-amber-500 hover:bg-amber-600 text-slate-900 rounded font-bold">Salvar Produto</button>
            </div>
        </form>
    </div>
</div>
